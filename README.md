# DB-project

# Описание
Интернет-магазин осуществляющий следующий функционал:

1) создание базы данных продуктов и их категорий

2) добавление продуктов в корзину и сохранение в пределах сессий Django

3) создание функционала оформления заказа и добавления заказа в БД

## Наименование
Интернет-магазин чая
## Предметная область
Интернет-торговля
# Данные
Категории, Товары, Заказы(данные о заказе), Заказы (данные об элементах заказа), Корзина(сессии)
## Для каждого элемента данных - ограничения
shop_category [id(bigint), name(varchar 200), slug(varchar 200), lft(int), rght(int), tree_id(int), level(int), parent_id(ForeignKey shop_category)]

shop_product [id(bigint), name(varchar 200), slug(varchar 200), image(varchar 200), decription(text), price(decimal(10,2)), stock(integer), available(boolean), created(timestamp [ (0) ] [ without time zone ]), updated(timestamp [ (0) ] [ without time zone ]), category_id(ForeignKey shop_category)]

orders_order [id(bigint), f_name(varchar(50)), l_name(varchar(50)), created(timestamp [ (0) ] [ without time zone ]), updated(timestamp [ (0) ] [ without time zone ]), address(varchar 250), email(varchar 254), city(varchar(100)), paid(bool), postal_code (varchar(100))]

orders_orderitem[id(bigint), price(decimal(10,2)), quantity(integer)), order_id(ForeignKey(orders_order)), product_id(ForeignKey shop_product)]

Cart (django_session) [django_session_id(varchar 50), {id:{quantiti, price}}, expire_date(timestamp [ (0) ] [ without time zone ])]

Структура остальных таблиц (не заявленных ранее - для аутентификации пользователей) находится в  файле shema.png

## Общие ограничения целостности
При удалении категории - удаляются товары этой категории, но при наличии заказа с товаром - товар невозможно удалить.

Возможные сценарии изменения количества товара:

При оформлении заказа с некоторым конкретным количеством единиц товара, в таблице товаров количество данного товара уменьшается на то количество которое заказали

При поступлении товара на склад менеджер увеличивает количество единиц данного товара через сайт администрирования

Список сортов и стран изменяем, менеджер может, например, добавить новый редкий сорт чая при его поступлении или страну, при поставке из новой страны.

# Пользовательские роли
## Для каждой роли - наименование, ответственность, количество пользователей в этой роли?
Работники магазина : 

 'Можно добавить разрешение',
 'Можно изменить разрешение',
 'Можно удалить разрешение',
 'Можно просмотреть разрешения',
 'Можно добавить группу',
 'Можно изменить группу',
 'Можно удалить группу',
 'Можно просмотреть группы',
 'Можно добавить пользователя',
 'Можно изменить пользователя',
 'Можно удалить пользователя',
 'Можно просмотреть пользователя',
 'Можно добавить категорию',
 'Можно изменить категорию',
 'Можно удалить категорию',
 'Можно просмотрить категории',
 'Можно добавить товар',
 'Можно изменить товар',
 'Можно удалить товар',
 'Можно просмотреть товар',
 'Можно изменить товар',
 'Можно удалить заказ',
 'Можно просмотреть заказ',
 'Можно просмотреть элемент заказа' 
 
Количество пользователей - 10.

Суперпользователь - 1 пользователь имеет все разрешения из списка

Возможно создание групп пользователей по ответственностям

Каждому работнику магазина (как и группе пользователей) можно выдать разрешения из списка (т.е можно разграничить тех кто изменяет заказ и удаляет во избежание нечестных менеджеров)

Покупатель: добавление товара в корзину, оформление заказа. Количество пользователей - 10000.
# UI / API 
ui - сайт

# Инструкция по использованию
Пользователь

Пользователь заходит на сайт.Он может выбрать нужную ему категорию или подкатегорию (для этого ему нужно выбрать соответсвующее поле в списке). После выбора понравившегося товара, пользователю откроется карточка товара, где он может выбрать количество этого товара и добавить этот товар в корзину. После добавления товара в корзину пользователю будет показана корзина с товарами, где он при необходимости может удалить ненужный товар. После добавления всех необходимых товаров в корзину пользователь может сделать заказ, нажав кнопку оформить заказ и указав все данные. Как только пользователь нажмет на кнопку создать заказ ему высветится сообщение об успешном или неуспешном создании заказа и придет сообщение на почту с информацией о заказе.

Персонал
После авторизации персонал имеет все полномочия перечисленные в полномочиях работниках магазина

# Описание транзакций
При создании заказа происходит несколько запросов к БД - для каждого элемента заказа мы пересчитываем его текущее количество в базе данных:

  -находим старое количество товара

  -считаем новое количество
  
  -записываем новое количество
  
Рассмотрим две ситуации:

1. При единовременном заказе одного и того же товара, например, двух пользователей, новое количество товара может посчитаться с учетом одного и того же старого, а не старого обновленного (для второго пользователя)

2. Во время выполнения одного из запросов сервер по какой-либо причине потерял связь с базой данных. В базе данных в таком случае либо не уменьшиться количество товаров, при том что заказ будет создан или же уменьшиться количество товаров при том что заказ создан не будет.

Поэтому следует рассматривать эти запросы к БД как одну транзакцию

# Технологии разработки
Celery - распределённая очередь заданий, реализованная на языке Python
## Язык программирования
Python(Django)
## СУБД
PostgreSQL
# Тестирование
Ручное тестирование
